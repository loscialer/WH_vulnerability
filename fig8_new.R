# exposure

fig8_a_left <- exposure %>% 
  filter(!is.na(exposure))  %>% 
  ggplot(aes(x = reorder(bioregion, -pi, na.rm = TRUE), y = exposure, color = type)) +
  geom_boxplot() + 
  theme_pubr() +
  ylab("Exposure") +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_text(face = 'bold', size = 12),
        axis.text.x = element_blank(),
        axis.text.y = element_text(size = 12),
        legend.title = element_blank(),
        legend.text = element_blank(),
        legend.position = 'none',
        plot.margin = unit(c(1, 1, 1, 1), "cm")) +
  scale_y_continuous(breaks = c(1,2,3,4,5), limits = c(0,5), labels = c('Very Low', 'Low', 'Moderate', 'High','Very High')) +
  annotation_custom(grobTree(textGrob("A)", x = 0.05, y=0.97, hjust = 0, 
                                      gp=gpar(col="black", fontsize=12, fontface='bold'))))

fig8_a_right <- exposure %>% 
  filter(!is.na(exposure))  %>% 
  ggplot(aes(x = reorder(threat, -pi, na.rm = TRUE), y = exposure, color = type)) +
  geom_boxplot() + 
  theme_pubr() +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text = element_text(size = 12),
        axis.text.x = element_blank(),
        legend.title = element_blank(),
        legend.text = element_text(size = 12, face = 'bold'),
        axis.text.y = element_blank(),
        axis.ticks.x = element_blank(),
        plot.margin = unit(c(1, 1, 1, 1), "cm"),
        legend.position ="top", legend.box = "horizontal")+
  scale_color_discrete(labels = c('Climate change','Direct-anthropogenic'))  
  

# Sensitivity
fig8_b_left <- sensitivity %>% 
  filter(!is.na(sensitivity))  %>% 
  ggplot(aes(x = reorder(bioregion, -pi, na.rm = TRUE), y = sensitivity, color = type)) +
  geom_boxplot() + 
  theme_pubr() +
  ylab("Sensitivity") +
  labs(color = 'Threat') +
  theme(axis.title.x = element_blank(),
        axis.title.y = element_text(face = 'bold', size = 12),
        axis.text.y = element_text(size = 12),
        legend.position = 'none',
        axis.text.x = element_blank(),
        axis.ticks.x = element_blank(),
        plot.margin = unit(c(1, 1, 1, 1), "cm")) + 
  scale_y_continuous(breaks = c(1,2,3,4,5), limits = c(0,5), labels = c('Very Low', 'Low', 'Moderate', 'High', 'Very High')) +
  annotation_custom(grobTree(textGrob("B)", x = 0.05, y=0.97, hjust = 0, 
                                      gp=gpar(col="black", fontsize=12, fontface='bold'))))

fig8_b_right <- sensitivity %>% 
  filter(!is.na(sensitivity))  %>% 
  ggplot(aes(x = reorder(threat, -pi, na.rm = TRUE), y = sensitivity, color = type)) +
  geom_boxplot() + 
  theme_pubr() +
  theme(axis.title.x = element_blank(),
        axis.text = element_blank(),
        axis.text.x = element_blank(),
        legend.position = 'none',
        axis.title.y = element_blank(),
        axis.ticks.x = element_blank(),
        plot.margin = unit(c(1, 1, 1, 1), "cm")) + 
  scale_y_continuous(breaks = c(1,2,3,4,5), limits = c(0,5))


# Plot Potential Impacts
fig8_c_left <- pi_df1 %>% 
  mutate(bioregion = fct_reorder(bioregion, potential_impact, .fun = 'median')) %>% 
  filter(!is.na(pi)) %>% 
  ggplot(aes(x = reorder(bioregion, -potential_impact), y = potential_impact, color = type)) + 
  geom_boxplot() +
  theme_pubr() +
  xlab('Bioregions (Short et al., 2007)') +
  ylab("Potential impact") +
  theme(axis.title.x = element_text(face = 'bold', size = 12, margin = margin(t = 10)),
        axis.title.y = element_text(face = 'bold', size = 12),
        axis.text = element_text(size = 12),
        axis.text.x = element_text(angle = 0),
        legend.position = 'none',
        plot.margin = unit(c(1, 1, 1, 1), "cm")) +
  scale_x_discrete(labels = c('TemAtl','Med',
                              'TemPac','TemSO',
                              'TropI-P','TropAtl')) +
  scale_color_discrete(labels = c('Climate change','Anthropogenic')) +
  scale_y_continuous(breaks = c(5,10,15,20), labels = c('Low', 'Moderate','High','Extreme'), limits = c(0,20)) +
  annotation_custom(grobTree(textGrob("C)", x = 0.05, y=0.97, hjust = 0, 
                                       gp=gpar(col="black", fontsize=12, fontface='bold')))) 

fig8_c_right <- pi_df1 %>% 
  filter(!is.na(pi)) %>% 
  ggplot(aes(x = reorder(threat, -potential_impact), y = potential_impact, color = type)) + 
  geom_boxplot() +
  theme_pubr() +
  xlab('Stressors / Activities') +
  theme(axis.title.x = element_text(face = 'bold', size = 12, margin = margin(t = 10)),
        axis.title.y = element_blank(),
        axis.text = element_text(size = 12),
        axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 0.95),
        legend.position = 'none',
        plot.margin = unit(c(1, 1, 1, 1), "cm")) +
  scale_color_discrete(labels = c('Climate change','Anthropogenic')) +
  scale_y_continuous(breaks = c(5,10,15,20), labels = c(), limits = c(0,20)) +
  scale_x_discrete(labels = c('CD','SST','AR','OF','MH','U/IR','DRG','DR','OA','TRA','S','R','SLR','SRBA','AQI','LCBA','SRBP','LCBP','SWQ'))


fig8 <- (fig8_a_left + fig8_a_right)/(fig8_b_left + fig8_b_right) / (fig8_c_left+ fig8_c_right)

fig8
