---
title: "managers"
author: "Riccardo Losciale"
date: "01/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r Libraries, message=FALSE, warning=FALSE, include=FALSE}
library('tidyr')
library('dplyr')
library('ggplot2')

```


```{r open file, include=FALSE}
managers <- read.csv('../Data/managers.csv')
```


```{r data_manipulation, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
managers[sapply(managers, is.character)] <- lapply(managers[sapply(managers, is.character)], 
as.factor)
managers[sapply(managers, is.logical)] <- lapply(managers[sapply(managers, is.logical)], 
as.factor)
```


```{r data_manipulation1, include=FALSE}
managers <- managers %>% mutate(across(.cols = matches("^sp_.{2,}$"),
                            ~ recode_factor(.x, 'Not present' = '1',
                                            'Restricted (? 10%)' = '2',
                                            'Localized (11 - 50 %)' = '3', 
                                            'Extensive (51 - 90%)' = '4',
                                            'Very widespread (91 - 100%)' = '5'))) %>% 
  mutate(across(.cols = matches("^fr_.{2,}$"), 
                ~ recode_factor(.x, 
                                'Never occurs' = '1', 
                                'Intermittent' = '2', 
                                'Occasional' = '3', 
                                'Frequent' = '4', 
                                'Ongoing' = '5' ))) %>% 
  mutate(across(.cols = matches("^tr_.{2,}$"),
                ~ recode_factor(.x, 'Decreasing' = '1', 
                                'Stable' = '2',
                                'Increasing' = '3')))

#OUV dependency
managers <- managers %>% mutate(OUV = ifelse(ouv_5 == 1, 5, 
                                 ifelse(ouv_4 == 1 & ouv_5 != 1, 4, 
                                        ifelse(ouv_3 == 1 & ouv_4 != 1 & ouv_5 != 1, 3,
                                               ifelse(ouv_2 == 1 & ouv_3 != 1 & ouv_4 != 1 & ouv_5 != 1, 2, 
                                                    ifelse(ouv_1 == 1 & ouv_2 != 1 & ouv_3 != 1 & ouv_4 != 1 & ouv_5 != 1, 
                                                           1, NA))))))
# Community dependency
managers <- managers %>% mutate(COM = com_food + com_eco + com_social + com_cultural,
                    COM = ifelse(COM == 0 & com_no_imp == 0, NA, COM))
# Adaptive capacity
managers <- managers %>% mutate(ad_res = recode_factor(ad_res, 'None' = 1, 'Low Resources' = 2,
                                           'Moderate Resources' = 3, 'High Resources' = 4),
                    ad_sci = recode_factor(ad_sci,'None' = 1,
                                           'Low Support' = 2,
                                           'Moderate Support' = 3,
                                           'High Support' = 4),
                    ad_cc = recode_factor(ad_cc, 'Very Low/None' = 1,
                                          'Low' = 2,
                                          'Moderate' = 3,
                                          'High' = 4)) 
managers <- managers %>% mutate(certainty = ifelse(info_se == 1, 4, 
                                 ifelse(info_ce == 1 & info_se != 1, 3, 
                                        ifelse(info_cm == 1 & info_se != 1 & info_ce != 1, 2,
                                               ifelse(info_pe == 1 & info_cm != 1 & info_ce != 1 & info_se != 1, 1,0))))) 


```



```{r data_manipulation2, include=FALSE}
managers_cleaned <- managers %>% select(- c(ouv_0:info_se)) 

managers_cleaned <- managers_cleaned %>% mutate(across(.cols = sp_ar:certainty, ~ as.numeric(as.character(.x))))

```


```{r rescale, include=FALSE}
rescale_3_to_5 <- function(x) {
  y = (x/3)*5
return(y)}
managers_cleaned <- managers_cleaned %>% mutate(across(matches('^tr_'), 
                            ~ rescale_3_to_5(.x)))

```



```{r data_manipulation3, include=FALSE}
managers_summary <- managers_cleaned %>% group_by(wh) %>% summarise(across(.cols = sp_ar:certainty,.fns = ~ mean(.x, na.rm = TRUE)))
managers_summary_long <- managers_summary %>% pivot_longer(sp_ar:tr_ao, names_to = c('index','threat'),
                                   names_pattern = '(.*)_(.*)', values_to = 'value') %>% 
  mutate(threat = as.factor(threat))
```


```{r exp, include=FALSE}
stderr <- function(x, na.rm=FALSE){
  if (na.rm) x <- na.omit(x)
  sqrt(var(x)/length(x))
}

exposure_m <- managers_summary_long %>% 
  group_by(wh,threat) %>% 
  summarise(exposure = mean(value, na.rm = TRUE),
            SE = stderr(value)) %>% 
  filter(!is.na(exposure))

exposure_m <- exposure_m %>% mutate(exposure1_m = round(exposure,0),
                    exposure_q_m = ifelse(exposure1_m == 1, 'Very Low',
                                        ifelse(exposure1_m == 2, 'Low',
                                               ifelse(exposure1_m == 3, 'Moderate',
                                                      ifelse(exposure1_m == 4, 'High', 'Very high')))))
exposure_m <- exposure_m %>% 
  mutate(type = ifelse(threat == 'mh'|threat == 'storm'|threat == 'dr'|threat == 'slr'|threat == 'sst'|threat == 'rain'|threat == 'ao','climate_change','human' ))
```

# Top 3 threats by exposure of World Heritage seagrass habitats. Data based on site managers responses
Table 1 - Top 3 stressor overall
Table 2 - Top 3 human stressors
Table 3 - Top 3 climate change stressors

```{r exposure tables, echo=FALSE, message=FALSE, warning=FALSE}
library('knitr')
th_ex_m_plot <- exposure_m %>% ggplot(aes(x = reorder(threat, -exposure), y = exposure)) +
    geom_boxplot()
wh_ex_plot <- exposure_m %>% ggplot(aes(x = reorder(wh, -exposure), y = exposure)) +
    geom_boxplot() + coord_flip()
top_3_cc <- exposure_m %>%
  filter(type == 'climate_change') %>% 
  group_by(wh) %>% 
  arrange(desc(exposure)) %>% 
  slice(1:3)
top_3_h <- exposure_m %>%
  filter(type == 'human') %>% 
  group_by(wh) %>% 
  arrange(desc(exposure)) %>% 
  slice(1:3)
top_3 <- exposure_m %>% arrange(desc(exposure)) %>% group_by(wh) %>% slice(1:3)
wh_exp <- exposure_m %>% 
  group_by(wh) %>% 
  summarise(mean = round(mean(exposure),2),
            SE = round(stderr(exposure),2))
            
wh_exp <- wh_exp %>% mutate(exposure = round(mean,0),
            exposure_q_m = ifelse(exposure == 1, 'Very Low',
                                ifelse(exposure == 2, 'Low',
                                       ifelse(exposure == 3, 'Moderate',
                                              ifelse(exposure == 4, 'High', 'Very high')))))


top_3 %>% kable()
top_3_h %>% kable()
top_3_cc %>% kable()

```


# Cumuative exposure to top 3 climate stressors 

```{r Cum_exp, echo=FALSE}
wh_exposure <- top_3_cc %>% 
  group_by(wh) %>% 
  summarise(mean_exp = mean(exposure)) %>% 
  mutate(mean_ex_r = round(mean_exp,0)) %>% 
  mutate(mean_ex_q = ifelse(mean_ex_r == 1, 'Very Low',
                            ifelse(mean_ex_r == 2, 'Low',
                                   ifelse(mean_ex_r == 3, 'Moderate',
                                          ifelse(mean_ex_r == 4, 'High', 'Very high')))))
wh_exposure_h <- top_3_h %>% 
  group_by(wh) %>% 
  summarise(mean_exp = mean(exposure)) %>% 
  mutate(mean_ex_r = round(mean_exp,0)) %>% 
  mutate(mean_ex_q = ifelse(mean_ex_r == 1, 'Very Low',
                            ifelse(mean_ex_r == 2, 'Low',
                                   ifelse(mean_ex_r == 3, 'Moderate',
                                          ifelse(mean_ex_r == 4, 'High', 'Very high')))))
wh_exposure %>% kable()
```

```{r Ad Cap, include=FALSE}
ad_cap <- managers %>% select(matches('^ad_.*'), wh)
ad_cap <- ad_cap %>% mutate(across(.cols = matches('^ad_.*'), ~ as.numeric(as.character(.x))))
ad_cap <- ad_cap %>% group_by(wh) %>% summarise(across(.cols = matches('^ad_.*'), ~ mean(.x, na.rm = TRUE))) %>% filter(!is.na(ad_res))
adaptive_capacity <- ad_cap %>% 
  group_by(wh) %>% 
  summarise(ad_cap = round(mean(c(ad_res,ad_sci,ad_cc), na.rm = TRUE),0))
adaptive_capacity <- adaptive_capacity %>% mutate(ad_cap_q = ifelse(ad_cap == 4, 'High',
                                                ifelse(ad_cap == 3, 'Moderate',
                                                        ifelse(ad_cap == 2, 'Low', 'None'))))

```

```{r Dependency, include=FALSE}
dependency <- managers %>% select(OUV,COM, wh)
dependency <- dependency %>% 
  group_by(wh) %>% 
  summarise(ou_dep = round(mean(OUV, na.rm = TRUE),0), com_dep = round(mean(COM, na.rm = TRUE),0)) %>%
  filter(!is.na(ou_dep)|!is.na(com_dep))

dependency <- dependency %>% mutate(ouv_dep_q = ifelse(ou_dep == 5, 'Very High',
                                         ifelse(ou_dep == 4, 'High',
                                                ifelse(ou_dep == 3, 'Moderate',
                                                       ifelse(ou_dep == 2, 'Low', 'Potential')))),
                                    com_dep_q = ifelse(com_dep == 4, 'Very High',
                                         ifelse(com_dep == 3, 'High',
                                                ifelse(com_dep == 2, 'Moderate',
                                                       ifelse(com_dep == 1, 'Low', 'No dependecy')))))
```


```{r open scientist, include=FALSE}
scientist <- read.csv('../Data/experts.csv')
```


```{r manipulate, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
scientist[sapply(scientist, is.character)] <- lapply(scientist[sapply(scientist, is.character)], 
as.factor)
scientist[sapply(scientist, is.logical)] <- lapply(scientist[sapply(scientist, is.logical)], 
as.factor)
```


```{r recode, include=FALSE}
scientist <- scientist %>% mutate(across(.cols = matches("^sp_.{2,}_b[1-6]$"),
                            ~ recode_factor(.x, 'X < 1 km^2' = '1',
                                            '1 ? X < 10 km^2' = '2',
                                            '10 ? X < 100 km^2' = '3', 
                                            '100 ? X < 1,000 km ^2' = '4',
                                            '1,000 ? X < 10,000 km^2' = '5',
                                            'X ? 10,000 km^2' = '6'))) %>% 
  mutate(across(.cols = matches("^fr_.{2,}_b[1-6]$"), 
                ~ recode_factor(.x, 
                                'Never occurs' = '1', 
                                'Intermittent' = '2', 
                                'Occasional' = '3', 
                                'Frequent' = '4', 
                                'Ongoing' = '5' ))) %>% 
  mutate(across(.cols = matches("^tr_.{2,}_b[1-6]$"),
                ~ recode_factor(.x, 'Decreasing' = '1', 
                                'Stable' = '2',
                                'Increasing' = '3'))) %>% 
  mutate(across(.cols = matches("^fi_.{2,}_b[1-6]$"), 
                            ~ recode_factor(.x, "No Impact" = '1', 
                                            'Spp. at geographic limit' = '2', 
                                            '? 25% of species' = '3',
                                            '25 < X ? 50% of species' = '4', 
                                            '50 < X ? 100% of species' = '5'))) %>% 
  mutate(across(.cols = matches("^res_.{2,}_b[1-6]$"), 
                            ~ recode_factor(.x, "Low resistance" = '3', 
                                            'Medium resistance' = '2', 
                                            'High resistance' = '1'))) %>% 
  mutate(across(.cols = matches("^rec_.{2,}_b[1-6]$"), 
                            ~ recode_factor(.x, "No Impact" = '1', 
                                            'X ? 1 year' = '2', 
                                            '1 < X ? 10 years' = '3',
                                            '10 < X ? 100 years' = '4', 
                                            'X > 100 years' = '5'))) %>% 
  mutate(across(.cols = matches('.*_cer$'),
                ~ recode_factor(.x, 'Low' = '1', 
                                'Medium' = '2',
                                'High' = '3',
                                'Very High' = '4')))
  
```





```{r rescale1, include=FALSE}
rescale_6_to_5 <- function(x) {
  y = (x/6)*5
return(y)}
scientist <- scientist %>% mutate(across(.cols = sp_sst_b1:rec_others_b52, ~ as.numeric(as.character(.x))))
scientist <- scientist %>% mutate(across(matches('^sp_.{2,}_b[1-6]$'), 
                            ~ rescale_6_to_5(.x))) %>%
  mutate(across(matches('^(tr|res)_.{2,}_b[1-6]$'), 
                            ~ rescale_3_to_5(.x)))
```


```{r spatial scale, include=FALSE}
sp <- scientist %>% select(matches('^sp_.{2,}_b[1-6]')) %>% select(-contains('other'))
# Make NA values as 0
sp[is.na(sp)] <- 0
col_sp <-seq(1,ncol(sp),by=2)
weighted_sp <- mapply(weighted.mean,sp[,col_sp],sp[,-col_sp],MoreArgs=list(paired=TRUE))
sp_df <- data.frame(as.list(weighted_sp))
sp_df <- sp_df %>% rename(sp_tra_b5 = sp_tr_b5, sp_tra_b6 = sp_tr_b6)
```


```{r frequency, include=FALSE}
fr <- scientist %>% select(matches('^fr_.{2,}_b[1-6]')) %>% select(-contains('other'))
# Make NA values as 0
fr[is.na(fr)] <- 0
col_fr <-seq(1,ncol(fr),by=2)
weighted_fr <- mapply(weighted.mean,fr[,col_fr],fr[,-col_fr],MoreArgs=list(paired=TRUE))
fr_df <- data.frame(as.list(weighted_fr))
fr_df <- fr_df %>% rename(fr_tra_b5 = fr_tr_b5, fr_tra_b6 = fr_tr_b6)

```


```{r trend, include=FALSE}
tre <- scientist %>% select(matches('^tr_.{2,}_b[1-6]')) %>% select(-contains('other'))
# Make NA values as 0
tre[is.na(tre)] <- 0
col_tre <-seq(1,ncol(tre),by=2)
weighted_tre <- mapply(weighted.mean,tre[,col_tre],tre[,-col_tre],MoreArgs=list(paired=TRUE))
tre_df <- data.frame(as.list(weighted_tre))

```

# Exposure of seagrass to various stressors. Results are based on seagrass expert opionion

```{r exposure, echo=FALSE, message=FALSE, warning=FALSE}
colnames(sp_df) <- sub("sp_", "", colnames(sp_df))
colnames(fr_df) <- sub("fr_", "", colnames(fr_df))
colnames(tre_df) <- sub("tr_", "", colnames(tre_df))



ex_df <- bind_rows(sp_df, fr_df, tre_df)
index <- c('sp','fr','tr')
ex_df$index <- index
ex_df <- ex_df %>% mutate(index = as.factor(index))
ex_df_long <- ex_df %>% pivot_longer(sst_b1:drg_b6, names_to = c('threat','bioregion'),
                                     names_pattern = '(.*)_(b[1-6])', values_to = 'value')

ex_df_long <- ex_df_long %>% mutate(threat = as.factor(threat),
                      bioregion = as.factor(bioregion))
exposure <- ex_df_long %>% group_by(threat, bioregion) %>% summarise(exposure = mean(value),
                                                                     sd = sd(value),
                                                                     SE = stderr(value),
                                                                     cv = (sd(value)/mean(value)*100))
exposure <- exposure %>% mutate(exposure1 = round(exposure,0),
                    exposure_q = ifelse(exposure1 == 1, 'Very Low',
                                        ifelse(exposure1 == 2, 'Low',
                                               ifelse(exposure1 == 3, 'Moderate',
                                                      ifelse(exposure1 == 4, 'High', 'Very high')))))
exposure <- exposure %>% 
  mutate(type = ifelse(threat == 'mh'|threat == 'storm'|threat == 'dr'|threat == 'slr'|threat == 'sst'|threat == 'rain'|threat == 'ao','climate_change','human' ))


exposure %>% kable()
```


```{r fi, include=FALSE}
fi <- scientist %>% select(matches('^fi_.{2,}_b[1-6]')) %>% select(-contains('other'))
# Make NA values as 0
fi[is.na(fi)] <- 0
col_fi <-seq(1,ncol(fi),by=2)
weighted_fi <- mapply(weighted.mean,fi[,col_fi],fi[,-col_fi],MoreArgs=list(paired=TRUE))
fi_df <- data.frame(as.list(weighted_fi))
```


```{r Res, include=FALSE}
res <- scientist %>% select(matches('^res_.{2,}_b[1-6]')) %>% select(-contains('other'))
# Make NA values as 0
res[is.na(res)] <- 0
col_res <-seq(1,ncol(res),by=2)
weighted_res <- mapply(weighted.mean,res[,col_res],res[,-col_res],MoreArgs=list(paired=TRUE))
res_df <- data.frame(as.list(weighted_res))

```


```{r Rec, include=FALSE}
rec <- scientist %>% select(matches('^rec_.{2,}_b[1-6]')) %>% select(-contains('other'))
# Make NA values as 0
rec[is.na(rec)] <- 0
col_rec <-seq(1,ncol(rec),by=2)
weighted_rec <- mapply(weighted.mean,rec[,col_rec],rec[,-col_rec],MoreArgs=list(paired=TRUE))
rec_df <- data.frame(as.list(weighted_rec))

```

# Sensitivity of seagass to various threats across bioregions. Results based on seagrass experts opinion

```{r Sensitivity, echo=FALSE, message=FALSE, warning=FALSE}
colnames(fi_df) <- sub("fi_", "", colnames(fi_df))
colnames(res_df) <- sub("res_", "", colnames(res_df))
colnames(rec_df) <- sub("rec_", "", colnames(rec_df))

sens_df <- bind_rows(fi_df, res_df, rec_df)
index1 <- c('fi','res','rec')
sens_df$index <- index1
sens_df_long <- sens_df %>% pivot_longer(sst_b1:drg_b6, names_to = c('threat','bioregion'),
                                     names_pattern = '(.*)_(b[1-6])', values_to = 'value')

sens_df_long <- sens_df_long %>% mutate(index = as.factor(index),
                      threat = as.factor(threat),
                      bioregion = as.factor(bioregion))
sensitivity <- sens_df_long %>% group_by(threat, bioregion) %>% summarise(sensitivity = mean(value),
                                                                     sd = sd(value),
                                                                     SE = stderr(value),
                                                                     cv = (sd(value)/mean(value)*100))
sensitivity <- sensitivity %>%  mutate(sensitivity1 = round(sensitivity,0),
                    sensitivity_q = ifelse(sensitivity1 == 1, 'Very Low',
                                        ifelse(sensitivity1 == 2, 'Low',
                                               ifelse(sensitivity1 == 3, 'Moderate',
                                                      ifelse(sensitivity1 == 4, 'High', 'Very high')))))

sensitivity <- sensitivity %>% 
  mutate(type = ifelse(threat == 'mh'|threat == 'storm'|threat == 'dr'|threat == 'slr'|threat == 'sst'|threat == 'rain'|threat == 'ao','climate_change','human' ))

sensitivity %>% kable()
```


```{r Vulnerability indeces, echo=FALSE, message=FALSE, warning=FALSE}
aldabra_s <- sensitivity %>% 
  filter(bioregion == 'b5', 
         threat %in% c('mh','dr','sst','srba','srbp','lcba'))

aldabra_e_m <- exposure_m %>% 
  filter(wh == 'Aldabra Atoll', 
         threat %in% c('mh','dr','sst','srba','srbp','lcba'))

aldabra_e_s <- exposure %>% 
  filter(bioregion == 'b5', 
         threat %in% c('mh','dr','sst','srba','srbp','lcba')) %>% rename(exposure_s = exposure)

aldabra <- full_join(aldabra_s, aldabra_e_m)
aldabra <- full_join(aldabra, aldabra_e_s)
aldabra <- aldabra %>% mutate(potential_impact = exposure*sensitivity)
pi_aldabra <- aldabra %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_aldabra <- adaptive_capacity %>% filter(wh == 'Aldabra Atoll') %>% select(-wh)
pi_aldabra_cc <-  pi_aldabra %>% filter(type == 'climate_change')
vul_aldabra <- full_join(pi_aldabra_cc, ad_aldabra, by = character())

vul_aldabra[sapply(vul_aldabra, is.character)] <- lapply(vul_aldabra[sapply(vul_aldabra, is.character)], 
as.factor)

vul_aldabra <- vul_aldabra %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_aldabra <- dependency %>% filter(wh == 'Aldabra Atoll') %>% select(-wh)
vul_aldabra_sea <- full_join(vul_aldabra, dep_aldabra, by = character())




belize_s <- sensitivity %>% 
  filter(bioregion == 'b2', 
         threat %in% c('storm','sst','srba','swq','cd'))

belize_e_m <- exposure_m %>% 
  filter(wh == 'Belize Barrier Reef Reserve System', 
         threat %in% c('storm','sst','srba','swq','cd'))

belize_e_s <- exposure %>% 
  filter(bioregion == 'b2', 
         threat %in% c('storm','sst','srba','swq','cd')) %>% rename(exposure_s = exposure)

belize <- full_join(belize_s, belize_e_m)
belize <- full_join(belize, belize_e_s)
belize <- belize %>% mutate(potential_impact = exposure*sensitivity)
pi_belize <- belize %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_belize <- adaptive_capacity %>% filter(wh == 'Belize Barrier Reef Reserve System') %>% select(-wh)
pi_belize_cc <-  pi_belize %>% filter(type == 'climate_change')
vul_belize <- full_join(pi_belize_cc, ad_belize, by = character())

vul_belize[sapply(vul_belize, is.character)] <- lapply(vul_belize[sapply(vul_belize, is.character)], 
as.factor)

vul_belize <- vul_belize %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_belize <- dependency %>% filter(wh == 'Belize Barrier Reef Reserve System') %>% select(-wh)
vul_belize_sea <- full_join(vul_belize, dep_belize, by = character())



everglades_s <- sensitivity %>% 
  filter(bioregion == 'b2', 
         threat %in% c('slr','sst','ao','srbp','cd','srba'))

everglades_e_m <- exposure_m %>% 
  filter(wh == 'Everglades National Park', 
         threat %in% c('slr','sst','ao','srbp','cd','srba'))

everglades_e_s <- exposure %>% 
  filter(bioregion == 'b2', 
         threat %in% c('slr','sst','ao','srbp','cd','srba')) %>% rename(exposure_s = exposure)

everglades <- full_join(everglades_s, everglades_e_m)
everglades <- full_join(everglades, everglades_e_s)
everglades <- everglades %>% mutate(potential_impact = exposure*sensitivity)
pi_everglades <- everglades %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_everglades <- adaptive_capacity %>% filter(wh == 'Everglades National Park') %>% select(-wh)
pi_everglades_cc <-  pi_everglades %>% filter(type == 'climate_change')
vul_everglades <- full_join(pi_everglades_cc, ad_everglades, by = character())

vul_everglades[sapply(vul_everglades, is.character)] <- lapply(vul_everglades[sapply(vul_everglades, is.character)], 
as.factor)

vul_everglades <- vul_everglades %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_everglades <- dependency %>% filter(wh == 'Everglades National Park') %>% select(-wh)
vul_everglades_sea <- full_join(vul_everglades, dep_everglades, by = character())

everglades %>% kable()
vul_everglades_sea %>% kable ()

gbr_s <- sensitivity %>% 
  filter(bioregion == 'b5', 
         threat %in% c('slr','sst','ao','srbp','lcba','srba'))

gbr_e_m <- exposure_m %>% 
  filter(wh == 'Great Barrier Reef', 
         threat %in% c('slr','sst','ao','srbp','lcba','srba'))

gbr_e_s <- exposure %>% 
  filter(bioregion == 'b5', 
         threat %in% c('slr','sst','ao','srbp','lcba','srba')) %>% rename(exposure_s = exposure)

gbr <- full_join(gbr_s, gbr_e_m)
gbr <- full_join(gbr, gbr_e_s)
gbr <- gbr %>% mutate(potential_impact = exposure*sensitivity)
pi_gbr <- gbr %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_gbr <- adaptive_capacity %>% filter(wh == 'Great Barrier Reef') %>% select(-wh)
pi_gbr_cc <-  pi_gbr %>% filter(type == 'climate_change')
vul_gbr <- full_join(pi_gbr_cc, ad_gbr, by = character())

vul_gbr[sapply(vul_gbr, is.character)] <- lapply(vul_gbr[sapply(vul_gbr, is.character)], 
as.factor)

vul_gbr <- vul_gbr %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_gbr <- dependency %>% filter(wh == 'Great Barrier Reef') %>% select(-wh)
vul_gbr_sea <- full_join(vul_gbr, dep_gbr, by = character())



high_coast_s <- sensitivity %>% 
  filter(bioregion == 'b1', 
         threat %in% c('slr','sst','rain','cd','ar','drg'))

high_coast_e_m <- exposure_m %>% 
  filter(wh == 'High Coast Kvarken Archipelago', 
         threat %in% c('slr','sst','rain','cd','ar','drg'))

high_coast_e_s <- exposure %>% 
  filter(bioregion == 'b1', 
         threat %in% c('slr','sst','rain','cd','ar','drg')) %>% rename(exposure_s = exposure)

high_coast <- full_join(high_coast_s, high_coast_e_m)
high_coast <- full_join(high_coast, high_coast_e_s)
high_coast <- high_coast %>% mutate(potential_impact = exposure*sensitivity)
pi_high_coast <- high_coast %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_high_coast <- adaptive_capacity %>% filter(wh == 'High Coast Kvarken Archipelago') %>% select(-wh)
pi_high_coast_cc <-  pi_high_coast %>% filter(type == 'climate_change')
vul_high_coast <- full_join(pi_high_coast_cc, ad_high_coast, by = character())

vul_high_coast[sapply(vul_high_coast, is.character)] <- lapply(vul_high_coast[sapply(vul_high_coast, is.character)], 
as.factor)

vul_high_coast <- vul_high_coast %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_high_coast <- dependency %>% filter(wh == 'High Coast Kvarken Archipelago') %>% select(-wh)
vul_high_coast_sea <- full_join(vul_high_coast, dep_high_coast, by = character())


ibiza_s <- sensitivity %>% 
  filter(bioregion == 'b3', 
         threat %in% c('mh','sst','rain','srbp','srba','drg'))

ibiza_e_m <- exposure_m %>% 
  filter(wh == 'Ibiza, Biodiversity and Culture', 
         threat %in% c('mh','sst','rain','srbp','srba','drg'))

ibiza_e_s <- exposure %>% 
  filter(bioregion == 'b3', 
         threat %in% c('mh','sst','rain','srbp','srba','drg')) %>% rename(exposure_s = exposure)

ibiza <- full_join(ibiza_s, ibiza_e_m)
ibiza <- full_join(ibiza, ibiza_e_s)
ibiza <- ibiza %>% mutate(potential_impact = exposure*sensitivity)
pi_ibiza <- ibiza %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact, na.rm = TRUE)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_ibiza <- adaptive_capacity %>% filter(wh == 'Ibiza, Biodiversity and Culture') %>% select(-wh)
pi_ibiza_cc <-  pi_ibiza %>% filter(type == 'climate_change')
vul_ibiza <- full_join(pi_ibiza_cc, ad_ibiza, by = character())

vul_ibiza[sapply(vul_ibiza, is.character)] <- lapply(vul_ibiza[sapply(vul_ibiza, is.character)], 
as.factor)

vul_ibiza <- vul_ibiza %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_ibiza <- dependency %>% filter(wh == 'Ibiza, Biodiversity and Culture') %>% select(-wh)
vul_ibiza_sea <- full_join(vul_ibiza, dep_ibiza, by = character())



new_cal_s <- sensitivity %>% 
  filter(bioregion == 'b5', 
         threat %in% c('slr','sst','storm','srbp','cd','mi'))

new_cal_e_m <- exposure_m %>% 
  filter(wh == 'Lagons de Nouvelle-Calédonie', 
         threat %in% c('slr','sst','storm','srbp','cd','mi'))

new_cal_e_s <- exposure %>% 
  filter(bioregion == 'b5', 
         threat %in% c('slr','sst','storm','srbp','cd','mi')) %>% rename(exposure_s = exposure)

new_cal <- full_join(new_cal_s, new_cal_e_m)
new_cal <- full_join(new_cal, new_cal_e_s)
new_cal <- new_cal %>% mutate(potential_impact = exposure*sensitivity)
pi_new_cal <- new_cal %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact, na.rm = TRUE)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_new_cal <- adaptive_capacity %>% filter(wh == 'Lagons de Nouvelle-Calédonie') %>% select(-wh)
pi_new_cal_cc <-  pi_new_cal %>% filter(type == 'climate_change')
vul_new_cal <- full_join(pi_new_cal_cc, ad_new_cal, by = character())

vul_new_cal[sapply(vul_new_cal, is.character)] <- lapply(vul_new_cal[sapply(vul_new_cal, is.character)], 
as.factor)

vul_new_cal <- vul_new_cal %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_new_cal <- dependency %>% filter(wh == 'Lagons de Nouvelle-Calédonie') %>% select(-wh)
vul_new_cal_sea <- full_join(vul_new_cal, dep_new_cal, by = character())



lord_howe_s <- sensitivity %>% 
  filter(bioregion == 'b6', 
         threat %in% c('ao','dr','rain','srbp','srba','ar'))

lord_howe_e_m <- exposure_m %>% 
  filter(wh == 'Lord Howe Island Group - Lord Howe Island Marine Park', 
         threat %in% c('ao','dr','rain','srbp','srba','ar'))

lord_howe_e_s <- exposure %>% 
  filter(bioregion == 'b6', 
         threat %in% c('ao','dr','rain','srbp','srba','ar')) %>% rename(exposure_s = exposure)

lord_howe <- full_join(lord_howe_s, lord_howe_e_m)
lord_howe <- full_join(lord_howe, lord_howe_e_s)
lord_howe <- lord_howe %>% mutate(potential_impact = exposure*sensitivity)
pi_lord_howe <- lord_howe %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact, na.rm = TRUE)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_lord_howe <- adaptive_capacity %>% filter(wh == 'Lord Howe Island Group - Lord Howe Island Marine Park') %>% select(-wh)
pi_lord_howe_cc <-  pi_lord_howe %>% filter(type == 'climate_change')
vul_lord_howe <- full_join(pi_lord_howe_cc, ad_lord_howe, by = character())

vul_lord_howe[sapply(vul_lord_howe, is.character)] <- lapply(vul_lord_howe[sapply(vul_lord_howe, is.character)], 
as.factor)

vul_lord_howe <- vul_lord_howe %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_lord_howe <- dependency %>% filter(wh == 'Lord Howe Island Group - Lord Howe Island Marine Park') %>% select(-wh)
vul_lord_howe_sea <- full_join(vul_lord_howe, dep_lord_howe, by = character())


ningaloo_s <- sensitivity %>% 
  filter(bioregion == 'b5', 
         threat %in% c('ao','slr','sst','srbp','srba','of'))

ningaloo_e_m <- exposure_m %>% 
  filter(wh == 'Ningaloo', 
         threat %in% c('ao','slr','sst','srbp','srba','of'))

ningaloo_e_s <- exposure %>% 
  filter(bioregion == 'b5', 
         threat %in% c('ao','slr','sst','srbp','srba','of')) %>% rename(exposure_s = exposure)

ningaloo <- full_join(ningaloo_s, ningaloo_e_m)
ningaloo <- full_join(ningaloo, ningaloo_e_s)
ningaloo <- ningaloo %>% mutate(potential_impact = exposure*sensitivity)
pi_ningaloo <- ningaloo %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact, na.rm = TRUE)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_ningaloo <- adaptive_capacity %>% filter(wh == 'Ningaloo') %>% select(-wh)
pi_ningaloo_cc <-  pi_ningaloo %>% filter(type == 'climate_change')
vul_ningaloo <- full_join(pi_ningaloo_cc, ad_ningaloo, by = character())

vul_ningaloo[sapply(vul_ningaloo, is.character)] <- lapply(vul_ningaloo[sapply(vul_ningaloo, is.character)], 
as.factor)

vul_ningaloo <- vul_ningaloo %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_ningaloo <- dependency %>% filter(wh == 'Ningaloo') %>% select(-wh)
vul_ningaloo_sea <- full_join(vul_ningaloo, dep_ningaloo, by = character())



banc_da_s <- sensitivity %>% 
  filter(bioregion == 'b2', 
         threat %in% c('dr','rain','mh','mi','of'))

banc_da_e_m <- exposure_m %>% 
  filter(wh == "Parc National du Banc d'Arguin", 
         threat %in% c('dr','rain','mh','mi','of'))

banc_da_e_s <- exposure %>% 
  filter(bioregion == 'b2', 
         threat %in% c('dr','rain','mh','mi','of')) %>% rename(exposure_s = exposure)

banc_da <- full_join(banc_da_s, banc_da_e_m)
banc_da <- full_join(banc_da, banc_da_e_s)
banc_da <- banc_da %>% mutate(potential_impact = exposure*sensitivity)
pi_banc_da <- banc_da %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact, na.rm = TRUE)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_banc_da <- adaptive_capacity %>% filter(wh == "Parc National du Banc d'Arguin") %>% select(-wh)
pi_banc_da_cc <-  pi_banc_da %>% filter(type == 'climate_change')
vul_banc_da <- full_join(pi_banc_da_cc, ad_banc_da, by = character())

vul_banc_da[sapply(vul_banc_da, is.character)] <- lapply(vul_banc_da[sapply(vul_banc_da, is.character)], 
as.factor)

vul_banc_da <- vul_banc_da %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_banc_da <- dependency %>% filter(wh == "Parc National du Banc d'Arguin") %>% select(-wh)
vul_banc_da_sea <- full_join(vul_banc_da, dep_banc_da, by = character())



tubbataha_s <- sensitivity %>% 
  filter(bioregion == 'b5', 
         threat %in% c('dr','sst','mh','lcbp','srba','srbp'))

tubbataha_e_m <- exposure_m %>% 
  filter(wh == "Tubbataha Reefs Natural Park and World Heritage Site", 
         threat %in% c('dr','sst','mh','lcbp','srba','srbp'))

tubbataha_e_s <- exposure %>% 
  filter(bioregion == 'b5', 
         threat %in% c('dr','sst','mh','lcbp','srba','srbp')) %>% rename(exposure_s = exposure)

tubbataha <- full_join(tubbataha_s, tubbataha_e_m)
tubbataha <- full_join(tubbataha, tubbataha_e_s)
tubbataha <- tubbataha %>% mutate(potential_impact = exposure*sensitivity)
pi_tubbataha <- tubbataha %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact, na.rm = TRUE)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_tubbataha <- adaptive_capacity %>% filter(wh == "Tubbataha Reefs Natural Park and World Heritage Site") %>% select(-wh)
pi_tubbataha_cc <-  pi_tubbataha %>% filter(type == 'climate_change')
vul_tubbataha <- full_join(pi_tubbataha_cc, ad_tubbataha, by = character())

vul_tubbataha[sapply(vul_tubbataha, is.character)] <- lapply(vul_tubbataha[sapply(vul_tubbataha, is.character)], 
as.factor)

vul_tubbataha <- vul_tubbataha %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_tubbataha <- dependency %>% filter(wh == "Tubbataha Reefs Natural Park and World Heritage Site") %>% select(-wh)
vul_tubbataha_sea <- full_join(vul_tubbataha, dep_tubbataha, by = character())



wadden_s <- sensitivity %>% 
  filter(bioregion == 'b1', 
         threat %in% c('slr','sst','rain','lcbp','drg','ar'))

wadden_e_m <- exposure_m %>% 
  filter(wh == "Wadden Sea", 
         threat %in% c('slr','sst','rain','lcbp','drg','ar'))

wadden_e_s <- exposure %>% 
  filter(bioregion == 'b1', 
         threat %in% c('slr','sst','rain','lcbp','drg','ar')) %>% rename(exposure_s = exposure)

wadden <- full_join(wadden_s, wadden_e_m)
wadden <- full_join(wadden, wadden_e_s)
wadden <- wadden %>% mutate(potential_impact = exposure*sensitivity)
pi_wadden <- wadden %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact, na.rm = TRUE)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_wadden <- adaptive_capacity %>% filter(wh == "Wadden Sea") %>% select(-wh)
pi_wadden_cc <-  pi_wadden %>% filter(type == 'climate_change')
vul_wadden <- full_join(pi_wadden_cc, ad_wadden, by = character())

vul_wadden[sapply(vul_wadden, is.character)] <- lapply(vul_wadden[sapply(vul_wadden, is.character)], 
as.factor)

vul_wadden <- vul_wadden %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_wadden <- dependency %>% filter(wh == "Wadden Sea") %>% select(-wh)
vul_wadden_sea <- full_join(vul_wadden, dep_wadden, by = character())



shark_bay_s <- sensitivity %>% 
  filter(bioregion == 'b6', 
         threat %in% c('mh','sst','ao','of','tra','srba'))

shark_bay_e_m <- exposure_m %>% 
  filter(wh == "Shark Bay", 
         threat %in% c('mh','sst','ao','of','tra','srba'))

shark_bay_e_s <- exposure %>% 
  filter(bioregion == 'b6', 
         threat %in% c('mh','sst','ao','of','tra','srba')) %>% rename(exposure_s = exposure)

shark_bay <- full_join(shark_bay_s, shark_bay_e_m)
shark_bay <- full_join(shark_bay, shark_bay_e_s)
shark_bay <- shark_bay %>% mutate(potential_impact = exposure*sensitivity)
pi_shark_bay <- shark_bay %>% 
  group_by(type) %>% 
  summarise(pi = mean(potential_impact, na.rm = TRUE)) %>% 
  mutate(potential_impact = ifelse(pi >= 20, 'Extreme', 
                              ifelse(pi > 10 & pi < 20, 'High',
                                     ifelse(pi > 5 & pi <= 10, 'Moderate', 'Low'))))
ad_shark_bay <- adaptive_capacity %>% filter(wh == "Shark Bay") %>% select(-wh)
pi_shark_bay_cc <-  pi_shark_bay %>% filter(type == 'climate_change')
vul_shark_bay <- full_join(pi_shark_bay_cc, ad_shark_bay, by = character())

vul_shark_bay[sapply(vul_shark_bay, is.character)] <- lapply(vul_shark_bay[sapply(vul_shark_bay, is.character)], 
as.factor)

vul_shark_bay <- vul_shark_bay %>% mutate(se_vu = ifelse(potential_impact == 'Low', 'Low',
                                      ifelse(potential_impact == 'Moderate' & ad_cap < 4, 'Moderate',
                                             ifelse(potential_impact == 'Moderate' & ad_cap == 4, 'Low',
                                                    ifelse(potential_impact == 'High' & ad_cap > 2, 'Moderate',
                                                           ifelse(potential_impact == 'High' & ad_cap < 3, 'High',
                                                                  ifelse(potential_impact == 'Extreme' & ad_cap == 4, 'Moderate',
                                                                         ifelse(potential_impact == 'Extreme' & ad_cap == 1,
                                                                                'Extreme', 'High'))))))))
dep_shark_bay <- dependency %>% filter(wh == "Shark Bay") %>% select(-wh)
vul_shark_bay_sea <- full_join(vul_shark_bay, dep_shark_bay, by = character())


```

# Aldabra
```{r Aldabra, echo=FALSE, message=FALSE, warning=FALSE}
aldabra %>% kable()
vul_aldabra_sea %>% kable ()
```

# Belize Barrier reef
```{r belize, echo=FALSE}
belize %>% kable()
vul_belize_sea %>% kable ()
```

# Great Barrier Reef
```{r gbr, echo=FALSE}
gbr %>% kable()
vul_gbr_sea %>% kable ()
```

# High Coast
```{r hc, echo=FALSE}
high_coast %>% kable()
vul_high_coast_sea %>% kable ()
```

# Ibiza Biodiversity and Culture
```{r ibiza, echo=FALSE}
ibiza %>% kable()
vul_ibiza_sea %>% kable()
```

# Lagoons of New Caledonia
```{r newcal, echo=FALSE}
new_cal %>% kable()
vul_new_cal_sea %>% kable()
```

# Lord Howe Island group
```{r lhi, echo=FALSE}
lord_howe %>% kable()
vul_lord_howe_sea %>% kable()
```

# Ningaloo Reef
```{r nr, echo=FALSE}
ningaloo %>% kable()
vul_ningaloo_sea %>% kable()
```

# Banc D Arguin
```{r bda, echo=FALSE}
banc_da %>% kable()
vul_banc_da_sea %>% kable()
```

# Tubbataha Reef
```{r tr, echo=FALSE}
tubbataha %>% kable()
vul_tubbataha_sea %>% kable()
```

# Wadden sea
```{r wadden, echo=FALSE}
wadden %>%  kable()
vul_wadden_sea %>% kable()
```

# Shark Bay
```{r sb, echo=FALSE}
shark_bay %>% kable()
vul_shark_bay_sea %>% kable()
```

```{r summary}
summary_pi_df <- bind_rows(aldabra, belize, gbr, high_coast, ibiza, new_cal, lord_howe, ningaloo, banc_da, tubbataha, wadden, shark_bay)

summary_vul_df <- bind_rows(vul_aldabra_sea, vul_belize_sea, vul_gbr_sea, vul_high_coast_sea, vul_ibiza_sea, vul_new_cal_sea, vul_lord_howe_sea, vul_ningaloo_sea, vul_banc_da_sea, vul_tubbataha_sea, vul_wadden_sea, vul_shark_bay_sea)
property <- c('Aldabra', 'Belize barrier reef', 'GBR', 'High Coast', 'Ibiza', 'Lagoons of New Caledonia', 'Lord Howe island group', 'Ningaloo Coast', "Banc D'Arguin", 'Tubbataha Reef', 'Wadden sea', 'Shark Bay' )
summary_vul_df$property <- property
```

